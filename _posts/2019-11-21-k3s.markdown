---
layout: post
title:  "k3s 使用笔记"
date:   2019-11-21 16:42:16 +0800
categories: sre
---

    k3s 手动安装、使用等笔记。
    轻量级的 Kubernetes。易于安装，一半内存，所有二进制文件不到 40mb。

## 安装

### 环境信息

```bash
$ lsb_release -d
Description:	Ubuntu 18.04.3 LTS
```

### 脚本安装

```bash
# 网络问题，无法下载，请使用手动下载安装方式
$ curl -sfL https://get.k3s.io | sh -
$ sudo kubectl get nodes
$ curl -sfL https://get.k3s.io | K3S_URL=https://myserver:6443 K3S_TOKEN=XXX sh -
```

### 手动下载安装

```bash
$ cd Downloads

# 访问 github.com 获取最新版本下载地址
$ wget https://github.com/rancher/k3s/releases/download/v1.0.0/k3s
$ chmod +x k3s
$ sudo mv k3s /usr/local/bin

# 此处使用脚本安装，加入 INSTALL_K3S_BIN_DIR_READ_ONLY="ture" 参数，避免下载 k3s 二进制文件
# 脚本支持的参数，详见 https://rancher.com/docs/k3s/latest/en/installation/install-options/
# 可以使用 https://raw.githubusercontent.com/rancher/k3s/v1.0.0/install.sh 连接，替换下面的链接，如果超时
$ curl -sfL https://get.k3s.io | INSTALL_K3S_BIN_DIR_READ_ONLY="ture" sh -
[INFO]  Finding latest release
[INFO]  Using v1.0.0 as release
[INFO]  Downloading hash https://github.com/rancher/k3s/releases/download/v1.0.0/sha256sum-amd64.txt
[INFO]  Skipping binary downloaded, installed k3s matches hash
[INFO]  Creating /usr/local/bin/kubectl symlink to k3s
[INFO]  Creating /usr/local/bin/crictl symlink to k3s
[INFO]  Skipping /usr/local/bin/ctr symlink to k3s, command exists in PATH at /usr/bin/ctr
[INFO]  Creating killall script /usr/local/bin/k3s-killall.sh
[INFO]  Creating uninstall script /usr/local/bin/k3s-uninstall.sh
[INFO]  env: Creating environment file /etc/systemd/system/k3s.service.env
[INFO]  systemd: Creating service file /etc/systemd/system/k3s.service
[INFO]  systemd: Enabling k3s unit
Created symlink /etc/systemd/system/multi-user.target.wants/k3s.service → /etc/systemd/system/k3s.service.
[INFO]  systemd: Starting k3s
```